(()=>{const t=t=>document.querySelector(t),e=t("#user-input"),a=t("#button"),o=t("#autocomplete"),n=t("#searchbar"),r=t("#error-message"),i=[],s=t("#background-photo"),c=t("#city-data-title"),l=t("#city-data-summary"),u=t("#city-data-categories"),d=t("#city-data-score");function p(){e.style.borderRadius="25px"}function y(){if(""!=e.value&&e===document.activeElement){e.style.borderRadius="24px 24px 0 0 ";let t=[];i.forEach((a=>{a.toLowerCase().includes(e.value.toLowerCase())&&t.push(`<li class="autocomplete-item" id="autocomplete-item">${a}</li>`)})),o.innerHTML=t.slice(0,5).join("")}else o.innerHTML=""}async function f(){let a=e.value.toLowerCase().replaceAll(" ","-").replaceAll(",","").replaceAll(".","");p();try{photo=await async function(t){let e=new URL(`https://api.teleport.org/api/urban_areas/slug:${t}/images/`),a=await fetch(e),o=await a.json();if(404!=a.status)return o;throw new Error("fetch")}(a),function(t){const{image:e}=t.photos[0];s.style.backgroundImage=`url(${e.web})`,s.style.padding="1em"}(photo),cityData=await async function(t){let e=new URL(`https://api.teleport.org/api/urban_areas/slug:${t}/scores/`),a=await fetch(e),o=a.json();if(404!=a.status)return o;throw new Error("fetch")}(a),function(t){const{summary:a,categories:o,teleport_city_score:n}=t;c.textContent=e.value.toUpperCase(),l.innerHTML=a,u.innerHTML=o.map((t=>`<li class="city-data-categorie">${t.name}: ${Math.floor(t.score_out_of_10)}/10</li>`)).join(""),d.textContent=`Overall score ${n.toFixed(2)}`,Number(`${n.toFixed(2)}`)>59.99?d.style.color="green":d.style.color="red"}(cityData),async function(){let e=t("#city-data"),a=t("#search-section");s.style.backgroundColor="#5a5a5a",s.style.borderBottom="1px solid #5f6368",e.style.border="1px solid #5f6368",e.style.boxShadow="0 1px 6px 0 #171717",a.style.marginTop="0"}()}catch(t){r.textContent="City not found, if the city requested is not among the suggested ones its data is not available"}}!async function(){try{let t=await fetch("https://api.teleport.org/api/urban_areas/"),e=await t.json();if(404==t.status)throw new Error("fetch");console.log(t.status),e._links["ua:item"].forEach((t=>i.push(t.name)))}catch(t){r.textContent="Network Error"}}(),e.addEventListener("input",y),e.addEventListener("click",y),document.addEventListener("click",(()=>o.innerHTML="")),document.addEventListener("click",(()=>p())),a.addEventListener("click",(function(){e.value="",p()})),n.addEventListener("submit",(function(t){t.preventDefault(),""===e.value||" "===e.value?r.textContent="Type something to start the search!":(r.textContent="",f())})),o.addEventListener("click",(function(t){e.value=t.target.textContent,o.innerHTML="",r.textContent="",f()}))})();